<!doctype html><html lang=zh-cn><head><title>使用 NetworkManager 配置 Debian 路由器 ::
星野玲的博客</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="大约一年半前，小玲写了《使用 Debian 作为路由器》这篇文章。由于 Armbian 自带了 NetworkManager 而 Debian 没有自带 NetworkManager，所以当时小玲一开始就把 NetworkManager 卸载了，"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://blog.bling.moe/post/19/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://blog.bling.moe/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://blog.bling.moe/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://blog.bling.moe/img/favicon.png><link href=/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 NetworkManager 配置 Debian 路由器"><meta name=twitter:description content="大约一年半前，小玲写了《使用 Debian 作为路由器》这篇文章。由于 Armbian 自带了 NetworkManager 而 Debian 没有自带 NetworkManager，所以当时小玲一开始就把 NetworkManager 卸载了，不过现在小玲打算用上 NetworkManager。"><meta property="og:title" content="使用 NetworkManager 配置 Debian 路由器"><meta property="og:description" content="大约一年半前，小玲写了《使用 Debian 作为路由器》这篇文章。由于 Armbian 自带了 NetworkManager 而 Debian 没有自带 NetworkManager，所以当时小玲一开始就把 NetworkManager 卸载了，不过现在小玲打算用上 NetworkManager。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.bling.moe/post/19/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-10-01T08:00:00+08:00"><meta property="article:modified_time" content="2023-11-24T22:31:47+08:00"><meta property="og:site_name" content="星野玲的博客"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>星野玲的博客</span>
<span class=logo__cursor></span></a>
<span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/index.xml>RSS</a></li><li><a href=/about/>关于</a></li><li><a href=/links/>友链</a></li><ul class=menu__sub-inner><li class=menu__sub-inner-more-trigger>查看更多
<span class=menu__sub-inner-more-trigger-icon><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span></li><ul class="menu__sub-inner-more hidden"><li><a href=https://digital-garden.bling.moe>数字花园</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/index.xml>RSS</a></li><li><a href=/about/>关于</a></li><li><a href=/links/>友链</a></li><li><a href=https://digital-garden.bling.moe>数字花园</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><article class=post><h1 class=post-title>使用 NetworkManager 配置 Debian 路由器</h1><div class=post-meta><time class=post-date>2023-10-01</time>
<span class=post-moddate>(最后修改于：
2023-11-24)</span>
<span class=post-author>— 作者： 星野玲</span></div><span class=post-tags><a href=https://blog.bling.moe/tags/debian/>#Debian</a>&nbsp;
<a href=https://blog.bling.moe/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/>#路由器</a>&nbsp;
<a href=https://blog.bling.moe/tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/>#软路由</a>&nbsp;</span><div class=post-content><p>大约一年半前，小玲写了《<a href=https://blog.bling.moe/post/3/>使用 Debian 作为路由器</a>》这篇文章。由于 Armbian 自带了 NetworkManager 而 Debian 没有自带 NetworkManager，所以当时小玲一开始就把 NetworkManager 卸载了，不过现在小玲打算用上 NetworkManager。</p><p>这次小玲使用的系统是通过虚拟机安装的 Debian 12，默认没有安装 NetworkManager。</p><h2 id=安装-networkmanager>安装 NetworkManager
<a href=#%e5%ae%89%e8%a3%85-networkmanager class=h-anchor aria-hidden=true>#</a></h2><p>首先安装 NetworkManager，如果需要 PPPoE 拨号，还需要安装 <code>ppp</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y network-manager ppp
</span></span></code></pre></div><h2 id=nmcli-命令的使用>nmcli 命令的使用
<a href=#nmcli-%e5%91%bd%e4%bb%a4%e7%9a%84%e4%bd%bf%e7%94%a8 class=h-anchor aria-hidden=true>#</a></h2><h3 id=查看网络情况>查看网络情况
<a href=#%e6%9f%a5%e7%9c%8b%e7%bd%91%e7%bb%9c%e6%83%85%e5%86%b5 class=h-anchor aria-hidden=true>#</a></h3><p>通过 <code>nmcli</code> 命令查看当前网络情况。</p><p>可以看到有两个连接外部的网络设备——<code>ens33</code> 和 <code>ens34</code>。<code>ens34</code> 设备已经通过 DHCP 获取了 IP 地址。<code>ens33</code> 还没有被设置。小玲将 <code>ens34</code> 设备当作 WAN 口，<code>ens33</code> 设备当作 LAN 口。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ens34: connected to Wired connection 1
</span></span><span style=display:flex><span>        &#34;Intel 82545EM&#34;
</span></span><span style=display:flex><span>        ethernet (e1000), 00:0C:29:BD:87:34, hw, mtu 1500
</span></span><span style=display:flex><span>        ip4 default, ip6 default
</span></span><span style=display:flex><span>        inet4 192.168.█.9/26
</span></span><span style=display:flex><span>        route4 192.168.█.0/26 metric 100
</span></span><span style=display:flex><span>        route4 default via 192.168.█.1 metric 100
</span></span><span style=display:flex><span>        inet6 240█:████:████:████:████:████:████:████/64
</span></span><span style=display:flex><span>        inet6 fe80::90ec:3e41:215c:ac29/64
</span></span><span style=display:flex><span>        route6 fe80::/64 metric 1024
</span></span><span style=display:flex><span>        route6 240█:████:████:████::/64 metric 100
</span></span><span style=display:flex><span>        route6 default via fe80::████:████:████:████ metric 100
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lo: connected (externally) to lo
</span></span><span style=display:flex><span>        &#34;lo&#34;
</span></span><span style=display:flex><span>        loopback (unknown), 00:00:00:00:00:00, sw, mtu 65536
</span></span><span style=display:flex><span>        inet4 127.0.0.1/8
</span></span><span style=display:flex><span>        inet6 ::1/128
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ens33: unmanaged
</span></span><span style=display:flex><span>        &#34;Intel 82545EM&#34;
</span></span><span style=display:flex><span>        ethernet (e1000), 00:0C:29:BD:87:2A, hw, mtu 1500
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DNS configuration:
</span></span><span style=display:flex><span>        servers: 192.168.█.1
</span></span><span style=display:flex><span>        interface: ens34
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        servers: fe80::████:████:████:████
</span></span><span style=display:flex><span>        interface: ens34
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Use &#34;nmcli device show&#34; to get complete information about known devices and
</span></span><span style=display:flex><span>&#34;nmcli connection show&#34; to get an overview on active connection profiles.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Consult nmcli(1) and nmcli-examples(7) manual pages for complete usage details.
</span></span></code></pre></div><h3 id=查看网络设备>查看网络设备
<a href=#%e6%9f%a5%e7%9c%8b%e7%bd%91%e7%bb%9c%e8%ae%be%e5%a4%87 class=h-anchor aria-hidden=true>#</a></h3><p>使用 <code>nmcli d</code> 命令查看网络设备。</p><p>现在 <code>ens33</code> 设备并没有被 NetworkManager 管理，待会会通过 NetworkManager 创建一个连接，使其被 NetworkManager 管理。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>DEVICE  TYPE      STATE                   CONNECTION
</span></span><span style=display:flex><span>ens34   ethernet  connected               Wired connection 1
</span></span><span style=display:flex><span>lo      loopback  connected (externally)  lo
</span></span><span style=display:flex><span>ens33   ethernet  unmanaged               --
</span></span></code></pre></div><h3 id=查看网络连接>查看网络连接
<a href=#%e6%9f%a5%e7%9c%8b%e7%bd%91%e7%bb%9c%e8%bf%9e%e6%8e%a5 class=h-anchor aria-hidden=true>#</a></h3><p>使用 <code>nmcli c</code> 命令查看网络连接。</p><p>只有 <code>Wired connection 1</code> 这个 NetworkManager 自动创建的连接。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>NAME                UUID                                  TYPE      DEVICE
</span></span><span style=display:flex><span>Wired connection 1  7d5979e9-c222-3fa0-a86e-9c1ea3f330b5  ethernet  ens34
</span></span><span style=display:flex><span>lo                  609bc8f3-b78b-40c6-9836-9f67f0dab964  loopback  lo
</span></span></code></pre></div><h3 id=创建以太网连接>创建以太网连接
<a href=#%e5%88%9b%e5%bb%ba%e4%bb%a5%e5%a4%aa%e7%bd%91%e8%bf%9e%e6%8e%a5 class=h-anchor aria-hidden=true>#</a></h3><p>在 <code>ens33</code> 设备上创建一个名为 <code>lan</code> 的以太网连接，这个连接的 IPv4 地址为 <code>192.168.3.1/24</code>。注意创建时需要 <code>sudo</code> 给权限。</p><p>命令里带了双引号的是参数的值，小玲这里是为了让大家看得更明白。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c add type <span style=color:#e6db74>&#34;ethernet&#34;</span> con-name <span style=color:#e6db74>&#34;lan&#34;</span> ifname <span style=color:#e6db74>&#34;ens33&#34;</span> ipv4.method <span style=color:#e6db74>&#34;manual&#34;</span> ipv4.addresses <span style=color:#e6db74>&#34;192.168.3.1/24&#34;</span>
</span></span></code></pre></div><p>如果需要设置静态 IPv6 地址，可以这么添加。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c add type <span style=color:#e6db74>&#34;ethernet&#34;</span> con-name <span style=color:#e6db74>&#34;lan&#34;</span> ifname <span style=color:#e6db74>&#34;ens33&#34;</span> ipv4.method <span style=color:#e6db74>&#34;manual&#34;</span> ipv4.addresses <span style=color:#e6db74>&#34;192.168.3.1/24&#34;</span> ipv6.method <span style=color:#e6db74>&#34;manual&#34;</span> ipv6.addresses <span style=color:#e6db74>&#34;fddd:afcf::/64&#34;</span>
</span></span></code></pre></div><h3 id=查看连接详情>查看连接详情
<a href=#%e6%9f%a5%e7%9c%8b%e8%bf%9e%e6%8e%a5%e8%af%a6%e6%83%85 class=h-anchor aria-hidden=true>#</a></h3><p>可以通过 <code>nmcli c show &lt;connection_id|connection_uuid></code> 查看连接的详情。</p><p>比如要查看刚刚添加的 <code>lan</code> 连接，可以通过下面的命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nmcli c show <span style=color:#e6db74>&#34;lan&#34;</span>
</span></span></code></pre></div><h3 id=忽略自动下发的-dns-服务器地址>忽略自动下发的 DNS 服务器地址
<a href=#%e5%bf%bd%e7%95%a5%e8%87%aa%e5%8a%a8%e4%b8%8b%e5%8f%91%e7%9a%84-dns-%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%9c%b0%e5%9d%80 class=h-anchor aria-hidden=true>#</a></h3><p>因为 NetworkManager 会控制 <code>/etc/resolv.conf</code> 文件。里面通常是通过 DHCP 获取的 DNS 服务器地址。如果不想被 NetworkManager 控制 <code>/etc/resolv.conf</code> 文件，可以通过下面的命令忽略自动下发的 DNS 服务器地址</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c modify &lt;connection_id|connection_uuid&gt; ipv4.ignore-auto-dns <span style=color:#e6db74>&#34;yes&#34;</span> ipv6.ignore-auto-dns <span style=color:#e6db74>&#34;yes&#34;</span>
</span></span></code></pre></div><h3 id=删除一个连接>删除一个连接
<a href=#%e5%88%a0%e9%99%a4%e4%b8%80%e4%b8%aa%e8%bf%9e%e6%8e%a5 class=h-anchor aria-hidden=true>#</a></h3><p>删除一个连接可以用 <code>nmcli c delete &lt;connection_id|connection_uuid></code> 命令。</p><p>如果要把刚刚创建的 <code>lan</code> 连接删除，就可以使用下面的命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c delete <span style=color:#e6db74>&#34;lan&#34;</span>
</span></span></code></pre></div><h3 id=添加-pppoe-连接>添加 PPPoE 连接
<a href=#%e6%b7%bb%e5%8a%a0-pppoe-%e8%bf%9e%e6%8e%a5 class=h-anchor aria-hidden=true>#</a></h3><p>如果要通过 <code>ens34</code> 设备使用 PPPoE 拨号，可以创建这么一个连接。</p><p><code>username</code> 和 <code>password</code> 的值，请填写自己的宽带账号和密码。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c add type <span style=color:#e6db74>&#34;pppoe&#34;</span> con-name <span style=color:#e6db74>&#34;pppoe&#34;</span> ifname <span style=color:#e6db74>&#34;ens34&#34;</span> username <span style=color:#e6db74>&#34;&#34;</span> password <span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div><p>添加成功后，通过下面的命令启动刚刚添加的 <code>pppoe</code> 连接。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c up pppoe
</span></span></code></pre></div><p>值得注意的是，通过 <code>nmcli c add</code> 添加的所有连接，都是默认开机自启动的。所以 PPPoE 的连接也是开机自启动的。</p><p>注意在 Debian 上使用 PPPoE 拨号的前提是安装 <code>ppp</code>。如果还没有安装 <code>ppp</code>，请趁着能联网时安装 <code>ppp</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y ppp
</span></span></code></pre></div><h3 id=获取-ipv6-pd-前缀>获取 IPv6 PD 前缀
<a href=#%e8%8e%b7%e5%8f%96-ipv6-pd-%e5%89%8d%e7%bc%80 class=h-anchor aria-hidden=true>#</a></h3><p>如果要获取 PD 前缀，并把它添加到 <code>lan</code> 连接上，可以使用下面的命令。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c modify <span style=color:#e6db74>&#34;lan&#34;</span> ipv6.method <span style=color:#e6db74>&#34;shared&#34;</span>
</span></span></code></pre></div><p>通过 NetworkManager 获取 PD 前缀时，几乎没有可以自定义的选项，例如前缀长度，路由器在 <code>lan</code> 连接上的主机地址。不过小玲只能获取一个 <code>/64</code> 前缀，所以不能配置也没有多大负面影响。</p><p>如果当前没有 PD 前缀，重新启用 <code>pppoe</code> 连接以获取 PD 前缀。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c down pppoe <span style=color:#f92672>&amp;&amp;</span> sudo nmcli c up pppoe
</span></span></code></pre></div><h4 id=自动重新获取-pd-前缀>自动重新获取 PD 前缀
<a href=#%e8%87%aa%e5%8a%a8%e9%87%8d%e6%96%b0%e8%8e%b7%e5%8f%96-pd-%e5%89%8d%e7%bc%80 class=h-anchor aria-hidden=true>#</a></h4><p>有时候，PPPoE 连接会自己断开重连，这时候如果 PD 前缀没有更新，会导致局域网内的设备无法使用 IPv6。</p><p>小玲为了解决这个问题，用了个野路子，思路就是写一个脚本，当 PPPoE 连接断开时，自动禁用并启用 PPPoE 连接以达到重新获取 PD 前缀的目的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/ppp/ipv6-down.d/restart_pppoe
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># CONNECTION_NAME 变量的值为 NetworkManager 里用于 PPPoE 拨号的连接名称</span>
</span></span><span style=display:flex><span>CONNECTION_NAME<span style=color:#f92672>=</span>pppoe
</span></span><span style=display:flex><span>nmcli c down $CONNECTION_NAME <span style=color:#f92672>&amp;&amp;</span> nmcli c up $CONNECTION_NAME
</span></span></code></pre></div><h3 id=添加一个带-vlan-id-的连接>添加一个带 VLAN ID 的连接
<a href=#%e6%b7%bb%e5%8a%a0%e4%b8%80%e4%b8%aa%e5%b8%a6-vlan-id-%e7%9a%84%e8%bf%9e%e6%8e%a5 class=h-anchor aria-hidden=true>#</a></h3><p>通过下面的命令来添加一个带 VLAN ID 的连接。</p><p><code>ifname</code> 的值可以自由设置，这里小玲就设置为 <code>ens33.10</code>。</p><p><code>vlan.parent</code> 的值是这个 VLAN 连接依附的网络设备的名称。</p><p><code>vlan.id</code> 的值可以自由设置，这里小玲就设置为 <code>10</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c add type <span style=color:#e6db74>&#34;vlan&#34;</span> ifname <span style=color:#e6db74>&#34;ens33.10&#34;</span> vlan.parent <span style=color:#e6db74>&#34;ens33&#34;</span> vlan.id <span style=color:#e6db74>&#34;10&#34;</span> ipv4.method <span style=color:#e6db74>&#34;manual&#34;</span> ipv4.addresses <span style=color:#e6db74>&#34;192.168.3.1/24&#34;</span>
</span></span></code></pre></div><h3 id=添加一个网桥并开启-wifi-热点>添加一个网桥并开启 WiFi 热点
<a href=#%e6%b7%bb%e5%8a%a0%e4%b8%80%e4%b8%aa%e7%bd%91%e6%a1%a5%e5%b9%b6%e5%bc%80%e5%90%af-wifi-%e7%83%ad%e7%82%b9 class=h-anchor aria-hidden=true>#</a></h3><p>如果路由器有多个网络设备，可以通过创建一个网桥将它们桥接起来。比如现在有一个 USB 无线网卡，要把它和 LAN 口桥接起来，LAN 提供有线连接，USB 无线网卡开启热点后提供无线连接。那么可以这么设置。</p><p>注意，如果 LAN 口上已经有连接了，需要先把 LAN 口的连接删除。</p><p>先用 <code>nmcli d</code> 查看 USB 无线网卡的设备名称。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>DEVICE                   TYPE      STATE                   CONNECTION
</span></span><span style=display:flex><span>ens34                    ethernet  connected               Wired connection 1
</span></span><span style=display:flex><span>lo                       loopback  connected (externally)  lo
</span></span><span style=display:flex><span>ens33                    ethernet  unmanaged               --
</span></span><span style=display:flex><span>wlx908d78eb1c7b          wifi      disconnected            --
</span></span><span style=display:flex><span>p2p-dev-wlx908d78eb1c7b  wifi-p2p  disconnected            --
</span></span></code></pre></div><p>USB 无线网卡的设备名称为 <code>wlx908d78eb1c7b</code>。</p><p>通过下面的命令创建一个名为 <code>bridge</code> 的网桥，<code>ifname</code> 的值可以自由设置，这里小玲就设置为 <code>br0</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c add type <span style=color:#e6db74>&#34;bridge&#34;</span> con-name <span style=color:#e6db74>&#34;bridge&#34;</span> ifname <span style=color:#e6db74>&#34;br0&#34;</span> ipv4.method <span style=color:#e6db74>&#34;manual&#34;</span> ipv4.addresses <span style=color:#e6db74>&#34;192.168.3.1/24&#34;</span>
</span></span></code></pre></div><p>将 <code>ens33</code> 设备加入刚刚创建的网桥。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c add type <span style=color:#e6db74>&#34;bridge-slave&#34;</span> ifname <span style=color:#e6db74>&#34;ens33&#34;</span> master <span style=color:#e6db74>&#34;br0&#34;</span>
</span></span></code></pre></div><p>通过下面的命令创建一个无线的连接。</p><p><code>wifi.band</code> 是 WiFi 的频段，值为 <code>a</code> 或 <code>bg</code>。无论哪个都是特别慢的，<code>nmcli</code> 并不支持 WiFi 5 甚至 WiFi 6。</p><p><code>wifi.ssid</code> 的值请填写自己想设置的 SSID。</p><p><code>802-11-wireless-security.key-mgmt "wpa-psk"</code> 和 <code>802-11-wireless-security.proto "rsn"</code> 这两个参数将 WiFi 加密方式设置为 WPA2。</p><p><code>802-11-wireless-security.psk</code> 的值请填写自己想设置的密码。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmcli c add type <span style=color:#e6db74>&#34;wifi&#34;</span> ifname <span style=color:#e6db74>&#34;wlx908d78eb1c7b&#34;</span> master <span style=color:#e6db74>&#34;br0&#34;</span> wifi.band <span style=color:#e6db74>&#34;a&#34;</span> wifi.mode <span style=color:#e6db74>&#34;ap&#34;</span> wifi.ssid <span style=color:#e6db74>&#34;&#34;</span> 802-11-wireless-security.key-mgmt <span style=color:#e6db74>&#34;wpa-psk&#34;</span> 802-11-wireless-security.proto <span style=color:#e6db74>&#34;rsn&#34;</span> 802-11-wireless-security.psk <span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div><p>小玲并不建议大家通过 NetworkManager 开启 WiFi 热点，因为速度实在是太慢了，如果有这方面的需求，小玲的建议是买一个无线路由器通过网线连接 LAN 口后当作 AP。</p><p>如果要使用 Tproxy 透明代理，小玲也不建议设置网桥。因为 nftables 对网桥的数据的处理有些问题。小玲在这里只是介绍这个方法而已，并不是建议大家使用网桥。</p><h3 id=连接-wifi>连接 WiFi
<a href=#%e8%bf%9e%e6%8e%a5-wifi class=h-anchor aria-hidden=true>#</a></h3><p>通过 <code>nmcli d wifi list ifname ""</code> 命令查看无线网卡，<code>ifname</code> 的值请填写自己的无线网卡设备名。如果只有一张无线网卡，那么这个命令可以省略为 <code>nmcli d wifi</code>。</p><p>通过 <code>nmcli d wifi connect "" password "" ifname ""</code> 命令连接 WiFi，<code>connect</code> 的值请填写要连接的 WiFi 的 SSID，<code>password</code> 的值请填写 WiFi 的密码，<code>ifname</code> 的值请填写自己的无线网卡设备名。如果只有一张无线网卡，那么 <code>ifname</code> 及其后面的内容可以省略。</p><h2 id=结尾>结尾
<a href=#%e7%bb%93%e5%b0%be class=h-anchor aria-hidden=true>#</a></h2><p>这篇文章更多的是一篇补充性而不是教程性的文章，所以没看过小玲之前的文章的话有可能看不懂。如果看不懂请看《<a href=https://blog.bling.moe/post/3/>使用 Debian 作为路由器</a>》和《<a href=https://blog.bling.moe/post/7/>Debian 软路由 + 华硕AX86U 实现多个 WiFi VLAN 隔离</a>》。</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>阅读其它文章</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://blog.bling.moe/post/20/><span class=button__icon>←</span>
<span class=button__text>使用 fnm 管理 Node.js 版本</span></a></span>
<span class="button next"><a href=https://blog.bling.moe/post/18/><span class=button__text>关于 router.push() 会报错这件事</span>
<span class=button__icon>→</span></a></span></div></div><script src=https://giscus.app/client.js data-repo=HoshinoRei/blog data-repo-id=R_kgDOGZbNzw data-category=General data-category-id=DIC_kwDOGZbNz84CPgAu data-mapping=pathname data-reactions-enabled=1 data-emit-metadata=1 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></div><footer class=footer><div class=footer__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>星野玲的博客</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span><a href=https://github.com/panr/hugo-theme-hello-friend target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-E6TTBX28QL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-E6TTBX28QL",{anonymize_ip:!1})}</script></body></html>